(function(t,e){"use strict";var s=function(t,s){if(void 0===t||null===t)return null;if(t.jquery&&(t=t[0]),s&&(this.placeholder=s.placeholder||"",this.changeCallback=s.onChange),this.isOpen=!1,this.activeOptions=0,this.hasEmptyElem=!1,this.focus=0,this.arrowCooldownTimer=null,this.arrowCooldown=!1,this.searchTimer=null,this.searchQuery="",this.select=t,this.select.addEventListener("change",this.onChange.bind(this),!1),this.select.style.display="none",0==this.select.options.length){this.hasEmptyElem=!0;var i=new Option("","",!0,!0);i.disabled=!0,this.select.add(i)}this.rootEl=e.createElement("span"),this.rootEl.className="select4",this.rootEl.setAttribute("tabindex","0"),this.rootEl.addEventListener("focus",this.onFocus.bind(this),!1),this.rootEl.addEventListener("blur",this.onBlur.bind(this),!1),this.rootEl.addEventListener("click",this.onClickRoot.bind(this),!1),this.rootEl.addEventListener("mouseover",this.onMouseOver.bind(this),!1),this.displaySpan=e.createElement("span"),this.select.selectedIndex>=0&&(this.displaySpan.innerHTML=this.select.options[this.select.selectedIndex].text),this.rootEl.appendChild(this.displaySpan),this.keyEventPress=this.onKeyPress.bind(this),this.keyEventDown=this.onKeyDown.bind(this),this.select.parentNode.insertBefore(this.rootEl,this.select);var o=this,l=function(t){return function(){o.selectAtIndex.call(o,t)}};this.optionsUl=e.createElement("ul");for(var n=0,h=this.select.options.length;n<h;n++){var c=this.select.options[n];if(!c.disabled){this.activeOptions++;var r=e.createElement("li");r.innerHTML=c.text,r["data-index"]=n,this.select.selectedIndex==n&&(r.className="selected"),r.addEventListener("click",l.call(this,n),!1),this.optionsUl.appendChild(r)}}this.select.selectedIndex<=0&&(this.displaySpan.className="placeholder",this.displaySpan.innerHTML=this.placeholder),this.optionsUl.addEventListener("click",this.onClickUl.bind(this),!1),this.rootEl.appendChild(this.optionsUl)};s.prototype.length=function(){return this.activeOptions},s.prototype.add=function(t,e){var s=new Option(t,e);this.addOption.call(this,s)},s.prototype.addOption=function(t){var s=this,i=t.selected;this.select.add(t),(o=e.createElement("li")).innerHTML=t.text;this.activeOptions++;var o=e.createElement("li"),l=this.select.options.length-1;if(o.innerHTML=t.text,o["data-index"]=l,o.addEventListener("click",function(t){return function(){s.selectAtIndex.call(s,t)}}.call(this,l),!1),this.optionsUl.appendChild(o),i){this.displaySpan.className="",this.displaySpan.innerHTML=this.select.options[this.select.selectedIndex].text;for(var n=this.select.selectedIndex,h=(l=0,this.optionsUl.childNodes.length);l<h;l++){(o=this.optionsUl.childNodes[l]).className=""}this.hasEmptyElem?this.optionsUl.childNodes[n-1].className="selected":this.optionsUl.childNodes[n].className="selected"}},s.prototype.deselect=function(){this.select.selectedIndex=0,this.displaySpan.className="placeholder",this.displaySpan.innerHTML=this.placeholder},s.prototype.remove=function(t){t>0&&(this.select.remove(t),Utils.dom.remove(this.optionsUl.childNodes[t-1]),this.activeOptions--)},s.prototype.removeAll=function(){for(;this.optionsUl.firstChild;)this.optionsUl.removeChild(this.optionsUl.firstChild);for(;this.select.options.length>1;)this.select.remove(this.select.options[this.select.options.length-1]);this.deselect.call(this)},s.prototype.onKeyPress=function(t){var e=t.which||t.keyCode;if(9!==e&&(t.preventDefault(),e)){var s=String.fromCharCode(e).replace(/^\s+|\s+$/g,"");s.length>0&&this.search.call(this,s)}},s.prototype.onKeyDown=function(t){var e=!0;switch(t.which){case 13:this.selectAtFocus(),this.close.call(this);break;case 27:this.close.call(this);break;case 38:if(!1===this.isOpen&&this.open.call(this),this.startArrowCooldown.call(this),null!==(i=this.optionsUl.querySelector(".focus"))){var s=i.previousElementSibling;null!==s&&this.focusOnElement.call(this,s)}else this.focusOnElement.call(this,this.optionsUl.lastChild);break;case 39:break;case 40:var i;if(!1===this.isOpen&&this.open.call(this),this.startArrowCooldown.call(this),null!==(i=this.optionsUl.querySelector(".focus"))){var o=i.nextElementSibling;null!==o&&this.focusOnElement.call(this,o)}else this.focusOnElement.call(this,this.optionsUl.firstChild);break;case 37:break;case 32:this.searchQuery.length>0&&this.search.call(this," ");break;default:e=!1}e&&t.preventDefault()},s.prototype.startArrowCooldown=function(){this.arrowCooldownTimer&&clearTimeout(this.arrowCooldownTimer),this.arrowCooldownTimer=setTimeout(this.endArrowCooldown.bind(this),200),this.arrowCooldown=!0},s.prototype.endArrowCooldown=function(){this.arrowCooldown=!1},s.prototype.open=function(){this.rootEl.classList.add("open"),this.optionsUl.style.display="block",this.isOpen=!0,this.select.selectedIndex>0&&this.focusOnIndex.call(this,this.select.selectedIndex);var e=this.optionsUl.clientHeight+this.rootEl.getBoundingClientRect().top-t.innerHeight;e>-30&&(this.optionsUl.style.marginTop=-(e+50)+"px")},s.prototype.close=function(){this.rootEl.classList.remove("open"),this.optionsUl.style.display="none",this.isOpen=!1},s.prototype.scrollToElem=function(t){var e=t.offsetTop,s=t.offsetHeight,i=this.optionsUl.offsetHeight,o=this.optionsUl.scrollTop;e+s<=o?this.optionsUl.scrollTop=e:e+s>=o+i&&(this.optionsUl.scrollTop=e-i+s)},s.prototype.focusOnIndex=function(t){t=t||this.select.selectedIndex;for(var e=0,s=this.optionsUl.childNodes.length;e<s;e++){var i=this.optionsUl.childNodes[e];i["data-index"]==t?(i.classList.add("focus"),this.scrollToElem.call(this,i)):i.classList.remove("focus")}},s.prototype.focusOnElement=function(t){for(var e=0,s=this.optionsUl.childNodes.length;e<s;e++){this.optionsUl.childNodes[e].classList.remove("focus")}t.classList.add("focus"),this.scrollToElem.call(this,t)},s.prototype.elemAtFocus=function(){for(var t=0;t<this.optionsUl.childNodes.length;t++){var e=this.optionsUl.childNodes[t];if(e.classList.contains("focus"))return e}return null},s.prototype.selectAtFocus=function(){var t=this.optionsUl.querySelector(".focus");null!==t&&this.selectAtIndex.call(this,parseInt(t["data-index"]))},s.prototype.elemAtIndex=function(t){for(var e=0;e<this.optionsUl.childNodes.length;e++){var s=this.optionsUl.childNodes[e];if(parseInt(s["data-index"])===t)return s}return null},s.prototype.search=function(t){this.startArrowCooldown.call(this),this.searchQuery+=t;for(var e=new RegExp("^"+this.searchQuery,"gi"),s=!1,i=0;i<this.select.options.length;i++){var o=this.select.options[i];if(e.exec(o.text)){this.focusOnIndex.call(this,o.index),this.selectAtFocus(),s=!0;break}}!1===s&&(this.searchQuery=""),null!==this.searchTimer&&clearTimeout(this.searchTimer),this.searchTimer=setTimeout(this.searchTimeout.bind(this),700)},s.prototype.searchTimeout=function(){this.searchQuery=""},s.prototype.onFocus=function(t){t.preventDefault(),t.stopPropagation(),this.rootEl.addEventListener("keypress",this.keyEventPress,!1),this.rootEl.addEventListener("keydown",this.keyEventDown,!1)},s.prototype.onBlur=function(t){t.preventDefault(),t.stopPropagation(),this.isOpen&&this.close.call(this),this.rootEl.removeEventListener("keypress",this.keyEventPress,!1),this.rootEl.removeEventListener("keydown",this.keyEventDown,!1)},s.prototype.onClickRoot=function(t){t.preventDefault(),t.stopPropagation(),this.open.call(this)},s.prototype.onClickUl=function(t){t.preventDefault(),t.stopPropagation(),this.close.call(this)},s.prototype.onMouseOver=function(t){if(!this.arrowCooldown){var e=t.target["data-index"];e&&this.focusOnIndex.call(this,e)}},s.prototype.onChange=function(){for(var t=this.select.selectedIndex,e=0,s=this.optionsUl.childNodes.length;e<s;e++){var i=this.optionsUl.childNodes[e];i["data-index"]==t?i.classList.add("selected"):i.classList.remove("selected")}this.displaySpan.className="",this.displaySpan.innerHTML=this.select.options[t].text,this.changeCallback&&this.changeCallback.call(this,this.select.options[t])},s.prototype.selectAtIndex=function(t){this.select.selectedIndex=t,this.onChange.call(this)},this.Select4=s}).call(this,window,document);